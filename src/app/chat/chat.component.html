<div class="container-fluid vh-100 d-flex flex-column">
  <div class="row flex-grow-1 overflow-hidden">
    <!-- Sidebar / Chat List -->
    <div class="col-12 col-md-4 col-lg-3 bg-dark-custom text-light p-0 d-flex flex-column sidebar"
      [class.d-none]="!isSidebarVisible && isMobile()">
      <div class="p-3 bg-header-custom">
        <input type="text" class="form-control " [(ngModel)]="searchText" (input)="filterChats()"
          placeholder="Search..." />
      </div>

      <!-- Chat List -->
      <ul class="list-group flex-grow-1 overflow-auto list-group-flush">
        @for (chat of chats; track $index) {
        <li
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center bg-dark-custom text-light border-0"
          [class.active]="chat === selectedChat" (click)="selectChat(chat)">
          <div class="d-flex align-items-center">
            <i class="fa fa-user-circle me-2" style="font-size: 20px"></i>
           
          
          @if((chat.users[0]._id === userId) || (chat.users[1]._id !== userId)) {
            
          
             <span class="badge color-white p-3 ms-2 ">{{ chat.users[1].fullName }}</span>}
             @else {
              <span class="badge color-white p-3 ms-2 ">{{ chat.users[0].fullName }}</span>}
             
          </div>
          <!-- @if (chat.latestMessage.content) { -->
            <!-- <span>{{ chat.latestMessage.content }}</span>} -->
            <!-- @else if (chat.latestMessage.photo) { -->
            <!-- <span>photo</span>} -->
            <!-- @else {<span></span>} -->
          <span class="badge bg-warning-custom">{{ chat.updatedAt| date : "shortTime" }}</span>
        </li>
        }
      </ul>
    </div>

    <!-- Chat Area -->
    <div class="col-12 col-md-8 col-lg-9 d-flex flex-column p-0 " [class.d-none]="isSidebarVisible && isMobile()">
      <!-- Toggle Sidebar Button on Mobile -->


      <!-- Chat Header -->
      <div class="bg-header-custom text-light p-2 d-flex align-items-center justify-content-between"
        *ngIf="selectedChat">
        <div class="d-flex align-items-center ">
          <i class="fa fa-user-circle me-2" style="font-size: 36px"></i>
          @if (selectedChat.users[0]._id === userId || selectedChat.users[1]._id !== userId) {
          <span class="h4 ">{{ selectedChat.users[1].fullName }}</span>}
          @else {
          <span class="h4 ">{{ selectedChat.users[0].fullName }}</span>}
        </div>
        <div *ngIf="!isSidebarVisible && isMobile()"
          class="d-md-none bg-header-custom text-light d-flex justify-content-between align-items-center ">
          <button class="btn btn-warning-custom" (click)="toggleSidebar()">â˜°</button>
        </div>
      </div>

      <!-- Chat Messages -->
      <div class="flex-grow-1 p-3  overflow-auto chat-messages " *ngIf="selectedChat">
        @for (message of messages; track $index) {
        <div class="mb-2">
          <div class=" rounded shadow-sm bg-white text-black d-flex flex-column mb-2 color-black ms-2 w-50 ">
            <!-- @if (message.updatedAt) {
             
                 <span class="fs-1 color-black">{{ message.updatedAt | date:"shortTime"}}</span>
            } -->
            @if (message.photo) {
               <img [src]="message.photo" alt="Uploaded Image" class="img-fluid mb-2 w-50 h-auto rounded"
                (click)="openImageModal(message.photo)" />
             }
            @if (message.content) {
              <p class="m-2 fs-6 color-black">{{ message?.content }}</p>
            }
            
            <small class="text-muted">{{  message.updatedAt | date:"shortTime"}}</small>
          </div>

        </div> 
      }
        
      </div>

      <!-- Message Input -->
      <div class="bg-white p-3 border-top d-flex align-items-center justify-content-between" *ngIf="selectedChat">
        <input type="text" class="form-control me-2" [(ngModel)]="content" (keydown)="onEnterPress($event)"
          placeholder="Type a message..." />
        <button class="btn btn-warning-custom me-2" (click)="sendMessage()">
          <i class="fa fa-paper-plane"></i>
        </button>

        <!-- File Upload -->
        <input type="file" id="fileInput" (change)="handleFileInput($event)" hidden />
        <button class="btn btn-warning-custom" (click)="triggerFileUpload()">
          <i class="fa fa-paperclip"></i>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Image Modal -->
@if (modalImage) {
<div class="modal fade show d-flex justify-content-center align-items-center bg-dark bg-opacity-75"
  style="z-index: 1050; display: block;">
  <span class="close-modal position-absolute text-light" (click)="closeImageModal()"
    style="top: 10px; right: 20px; font-size: 30px; cursor: pointer;">&times;</span>
  <img [src]="modalImage" class="img-fluid" alt="Enlarged Image" />
</div>
}


